FROM ubuntu:20.04

# install requirements for apache build
RUN apt update
RUN echo 135 | apt install software-properties-common -y
RUN apt install wget curl make gcc perl -y
RUN apt install libapr1-dev libaprutil1-dev libpcre3-dev -y

# install apache2-2.4.50
RUN wget https://archive.apache.org/dist/httpd/httpd-2.4.50.tar.gz
RUN tar -xf httpd-2.4.50.tar.gz
RUN rm httpd-2.4.50.tar.gz
RUN ./httpd-2.4.50/configure --prefix=/
RUN make && make install
RUN rm -rf httpd-2.4.50

# install suricata
RUN add-apt-repository -y ppa:oisf/suricata-stable
RUN apt install -y suricata
RUN systemctl enable suricata.service

# config suricata
COPY suricata.yaml /etc/suricata/suricata.yaml
RUN suricata-update

# config apache
ADD httpd.conf /conf/httpd.conf

# start apached
RUN apachectl -k start

ENTRYPOINT exec httpd -D "FOREGROUND"